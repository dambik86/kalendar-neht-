<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="MD Nails">
<meta name="theme-color" content="#A63E6C">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<link rel="manifest" href="manifest.json">
<title>MD Nails</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@500;600;700;800&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">
<style>
:root{--bg:#EACED8;--card:#FFF;--g1:#A63E6C;--g2:#6E3D5E;--g3:#8C2F58;--tx:#1A0A1A;--t2:#4A2840;--t3:#8A6A7E;--bd:#DFC0D0;--ok:#2E9460;--er:#CC3355;--blue:#3A7BD5;--sh:0 4px 24px rgba(120,50,90,.12);--sh2:0 8px 40px rgba(120,50,90,.18)}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:'DM Sans',-apple-system,sans-serif;background:var(--bg);color:var(--tx);min-height:100vh;min-height:100dvh;overflow-x:hidden;-webkit-font-smoothing:antialiased;font-weight:600;font-size:15px}
#app{max-width:600px;margin:0 auto;padding-bottom:90px}
.hdr{background:linear-gradient(145deg,var(--g1),var(--g2));padding:max(env(safe-area-inset-top,16px),16px) 18px 18px;color:#fff;border-radius:0 0 28px 28px;box-shadow:var(--sh2)}
.hdr.viewer{background:linear-gradient(145deg,var(--blue),#2A5A9E)}
.hdr-r{display:flex;align-items:center;gap:12px}
.hdr h1{font-family:'Playfair Display',serif;font-size:28px;font-weight:800}
.hdr .sub{font-size:14px;opacity:.92;font-family:'Playfair Display',serif;font-style:italic;font-weight:700;margin-top:2px}
.hdr-b{margin-left:auto;display:flex;gap:8px}
.hb{background:rgba(255,255,255,.18);border:none;border-radius:12px;width:40px;height:40px;color:#fff;font-size:18px;cursor:pointer}
.role-badge{display:inline-block;padding:3px 10px;border-radius:8px;font-size:11px;font-weight:800;margin-left:8px}
.role-admin{background:rgba(255,255,255,.25);color:#fff}
.role-view{background:rgba(255,255,255,.25);color:#fff}
.si{width:100%;padding:12px 16px;border-radius:14px;border:none;font-size:16px;font-weight:600;outline:none;font-family:inherit;margin-top:10px;background:rgba(255,255,255,.96)}
.bnav{position:fixed;bottom:0;left:0;right:0;background:rgba(255,255,255,.96);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-top:1px solid var(--bd);display:flex;justify-content:center;padding:8px 0 max(env(safe-area-inset-bottom,8px),8px);z-index:100}
.bnav button{flex:1;max-width:150px;border:none;background:none;padding:6px 4px;cursor:pointer;font-family:inherit;display:flex;flex-direction:column;align-items:center;gap:3px;color:var(--t3);font-size:11px;font-weight:700}
.bnav button.a{color:var(--g1)}
.bnav .ic{font-size:22px}
.sec{padding:12px 16px 0}
.dcard{margin:10px 16px 0;padding:16px 18px;border-radius:18px;box-shadow:var(--sh);border-left:5px solid var(--ok);background:linear-gradient(135deg,#F0FFF4,#E0F8EA)}
.dcard h4{font-size:16px;font-weight:800;color:#1E6B40;margin-bottom:8px;display:flex;align-items:center;justify-content:space-between}
.dcard .edit-btn{background:var(--ok);color:#fff;border:none;border-radius:10px;padding:6px 16px;font-size:12px;font-weight:800;cursor:pointer;font-family:inherit}
.dcard.tmrw{background:linear-gradient(135deg,#FFFBF0,#FFF3DC);border-color:#F0A830}
.dcard.tmrw h4{color:#C07800}
.di{display:flex;align-items:center;gap:10px;padding:7px 0;font-size:14px;font-weight:600;border-bottom:1px solid rgba(0,0,0,.05)}
.di:last-child{border:none}
.di-time{font-weight:800;font-size:16px;min-width:52px;color:var(--tx)}
.di-name{font-weight:700;flex:1}.di-svc{font-size:11px;font-weight:700;color:#fff;padding:2px 8px;border-radius:12px}
.di-done{color:var(--ok);font-size:13px}
.di-acts{display:flex;gap:4px}
.di-acts button{border:none;border-radius:8px;padding:4px 8px;font-size:11px;font-weight:700;cursor:pointer;font-family:inherit}
.cc{background:var(--card);border-radius:22px;padding:18px;box-shadow:var(--sh2);margin-bottom:14px}
.cc h2{font-family:'Playfair Display',serif;font-size:26px;text-align:center;color:var(--g3);margin-bottom:14px;font-weight:800}
.wr{display:grid;grid-template-columns:repeat(7,1fr);gap:2px;margin-bottom:8px}
.wd{text-align:center;font-size:12px;font-weight:800;color:var(--t3);padding:5px 0}
.dg{display:grid;grid-template-columns:repeat(7,1fr);gap:4px}
.dc{aspect-ratio:1;border-radius:14px;border:none;font-weight:700;font-size:16px;cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1px;background:transparent;color:var(--tx);font-family:inherit;position:relative}
.dc:active:not(.su){transform:scale(.85)}
.dc.to{background:linear-gradient(135deg,var(--g1),var(--g2));color:#fff;font-weight:800;box-shadow:0 4px 14px rgba(166,62,108,.4)}
.dc.sel{background:linear-gradient(135deg,var(--g1),var(--g2));color:#fff;font-weight:800;box-shadow:0 4px 14px rgba(166,62,108,.4)}
.dc.tw{background:#FFF0E0}.dc.pa{color:var(--t3)}.dc.su{color:#CCC;cursor:default}
.dc.hb2:not(.to):not(.sel){background:#F8EAF0}
.dc .badge{position:absolute;top:2px;right:2px;background:var(--g1);color:#fff;font-size:9px;font-weight:800;width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 6px rgba(0,0,0,.2)}
.dc.to .badge,.dc.sel .badge{background:#fff;color:var(--g1)}
.fc{background:var(--card);border-radius:22px;padding:22px;box-shadow:var(--sh2);margin-bottom:16px;border:2px solid #F0D0E0}
.fc h3{font-weight:800;color:var(--g3);font-size:18px;margin-bottom:18px}
.fl{margin-bottom:16px;position:relative}
.fl label{font-size:13px;font-weight:800;color:var(--t2);display:block;margin-bottom:6px;text-transform:uppercase}
.fl input,.fl textarea{width:100%;padding:13px 16px;border-radius:14px;border:2px solid var(--bd);font-size:16px;font-weight:600;outline:none;font-family:inherit;background:#FDFAFB;-webkit-appearance:none}
.fl input:focus,.fl textarea:focus{border-color:var(--g1);background:#fff}
.fl textarea{resize:none;font-size:15px}
.acomp{position:absolute;top:100%;left:0;right:0;background:var(--card);border:2px solid var(--bd);border-top:none;border-radius:0 0 14px 14px;max-height:120px;overflow-y:auto;z-index:50;display:none}
.acomp.show{display:block}
.aci{padding:10px 16px;font-size:14px;font-weight:600;cursor:pointer;border-bottom:1px solid var(--bd)}
.aci:active{background:var(--bg)}
.sg{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.sb{padding:13px;border-radius:14px;border:2px solid var(--bd);font-weight:700;font-size:14px;cursor:pointer;text-align:left;background:var(--card);color:var(--tx);font-family:inherit}
.sb.a{border-color:transparent;color:#fff;font-weight:800}
.sb small{display:block;font-size:11px;opacity:.65;margin-top:2px;font-weight:600}.sb.a small{opacity:.9}
.tg{display:grid;grid-template-columns:repeat(4,1fr);gap:6px}
.tm2{padding:11px 4px;border-radius:12px;border:2px solid var(--bd);font-weight:700;font-size:14px;cursor:pointer;background:var(--card);color:var(--tx);font-family:inherit;text-align:center}
.tm2.a{background:linear-gradient(135deg,var(--g1),var(--g2));color:#fff;border-color:transparent;box-shadow:0 3px 12px rgba(166,62,108,.3)}
.tm2.bk2{background:#F0E4EA;color:#CCC;border-color:#E8D4DE;text-decoration:line-through;cursor:not-allowed}
.fb{display:flex;gap:10px;margin-top:18px}
.bp{flex:1;padding:14px;border:none;border-radius:14px;background:linear-gradient(135deg,var(--g1),var(--g2));color:#fff;font-weight:800;font-size:16px;cursor:pointer;font-family:inherit}
.bs2{padding:14px 24px;background:#F0E4EA;border:none;border-radius:14px;font-weight:700;font-size:15px;cursor:pointer;color:var(--t2);font-family:inherit}
.stat-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:14px}
.stat-box{background:var(--card);border-radius:18px;padding:18px;box-shadow:var(--sh);text-align:center}
.stat-box .sv{font-size:32px;font-weight:800;line-height:1}
.stat-box .sl{font-size:12px;font-weight:700;color:var(--t2);margin-top:4px}
.top-card{background:var(--card);border-radius:20px;padding:18px;box-shadow:var(--sh);margin-bottom:12px}
.top-card h3{font-size:17px;font-weight:800;color:var(--g3);margin-bottom:12px}
.top-row{display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid var(--bd)}
.top-row:last-child{border:none}
.top-rank{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:13px;color:#fff;flex-shrink:0}
.top-name{flex:1;font-weight:700;font-size:15px}
.top-cnt{font-weight:800;font-size:18px;color:var(--g1)}
.sc2{background:var(--card);border-radius:20px;padding:18px;margin-bottom:12px;box-shadow:var(--sh)}
.sc2 h3{font-size:17px;font-weight:800;color:var(--g3);margin-bottom:14px}
.sr{display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid var(--bd);font-size:15px;font-weight:600}
.sr:last-child{border:none}
.sr label{font-weight:700;flex:1}
.sr input[type=number]{width:60px;padding:8px;border-radius:10px;border:2px solid var(--bd);font-size:14px;text-align:center;font-family:inherit;outline:none;font-weight:700}
.sr .sb3{background:linear-gradient(135deg,var(--g1),var(--g2));border:none;border-radius:10px;padding:8px 16px;color:#fff;font-weight:800;font-size:13px;cursor:pointer}
.se{display:flex;align-items:center;gap:6px;padding:8px 0;border-bottom:1px solid var(--bd)}
.se:last-of-type{border:none}
.se input[type=color]{width:34px;height:34px;border:none;border-radius:8px;cursor:pointer;padding:0}
.se input[type=text],.se input[type=number]{padding:8px;border-radius:8px;border:2px solid var(--bd);font-size:14px;font-weight:600;font-family:inherit;outline:none}
.se input:focus{border-color:var(--g1)}
.se input[type=text]{flex:1;min-width:0}
.se input[type=number]{width:54px;text-align:center}
.se .sd{background:#FDE8EC;color:var(--er);border:none;border-radius:8px;padding:6px 10px;font-size:12px;font-weight:800;cursor:pointer}
.sa{display:block;width:100%;margin-top:10px;background:#F8EAF0;border:2px dashed var(--bd);border-radius:14px;padding:12px;font-size:14px;font-weight:800;color:var(--g3);cursor:pointer;font-family:inherit}
.pr{display:flex;align-items:center;padding:12px 0;border-bottom:1px solid var(--bd);gap:10px}
.pr:last-child{border:none}
.pdt{width:14px;height:14px;border-radius:50%}.pn{flex:1;font-weight:700;font-size:15px}
.pdur{font-size:13px;color:var(--t2);font-weight:600}.pv{font-weight:800;font-size:18px;color:var(--g1)}
.mbg{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:900;display:flex;align-items:center;justify-content:center;padding:20px}
.mbox{background:var(--card);border-radius:24px;padding:24px;max-width:420px;width:100%;box-shadow:var(--sh2);max-height:85vh;overflow-y:auto}
.mbox h3{font-size:20px;font-weight:800;color:var(--g3);margin-bottom:16px}
.nf{position:fixed;top:20px;left:50%;transform:translateX(-50%);z-index:1000;padding:14px 30px;border-radius:16px;color:#fff;font-weight:800;font-size:15px;box-shadow:var(--sh2);display:none;animation:nfa .3s}
.nf.ok{background:var(--ok)}.nf.er{background:var(--er)}
@keyframes nfa{from{opacity:0;transform:translate(-50%,-16px)}to{opacity:1;transform:translate(-50%,0)}}
.login-bg{position:fixed;inset:0;background:linear-gradient(145deg,var(--g1),var(--g2));z-index:2000;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:16px}
.login-box{background:var(--card);border-radius:28px;padding:36px 28px;width:340px;text-align:center;box-shadow:var(--sh2)}
.login-box h2{font-family:'Playfair Display',serif;font-size:28px;color:var(--g3);margin-bottom:6px;font-weight:800}
.login-box p{color:var(--t2);font-size:14px;margin-bottom:20px;font-weight:600}
.login-box input{width:100%;padding:14px;border-radius:14px;border:2px solid var(--bd);font-size:22px;text-align:center;letter-spacing:10px;font-weight:800;outline:none;font-family:inherit;-webkit-appearance:none}
.login-box input:focus{border-color:var(--g1)}
.login-box button{width:100%;margin-top:12px;padding:14px;border:none;border-radius:14px;color:#fff;font-weight:800;font-size:16px;cursor:pointer;font-family:inherit}
.login-box .btn-admin{background:linear-gradient(135deg,var(--g1),var(--g2))}
.login-box .btn-viewer{background:linear-gradient(135deg,var(--blue),#2A5A9E)}
.login-box .err2{color:var(--er);font-size:13px;font-weight:700;margin-top:8px}
.login-box .divider{margin:16px 0;color:var(--t3);font-size:13px;font-weight:700;display:flex;align-items:center;gap:10px}
.login-box .divider::before,.login-box .divider::after{content:'';flex:1;height:1px;background:var(--bd)}
.sync-bar{margin:10px 16px 0;padding:10px 16px;border-radius:14px;background:var(--card);box-shadow:var(--sh);display:flex;align-items:center;gap:10px;font-size:13px;font-weight:700;color:var(--t2)}
.sync-bar .sync-dot{width:8px;height:8px;border-radius:50%;background:var(--ok);flex-shrink:0}
.sync-bar button{margin-left:auto;background:var(--blue);color:#fff;border:none;border-radius:10px;padding:6px 14px;font-weight:800;font-size:12px;cursor:pointer;font-family:inherit}
.ri{background:var(--card);border-radius:16px;padding:12px 16px;margin-bottom:8px;box-shadow:var(--sh);display:flex;justify-content:space-between;align-items:center;border:1px solid var(--bd)}
.em{background:var(--card);border-radius:20px;padding:40px 20px;text-align:center;box-shadow:var(--sh)}
.em p{color:var(--t2);font-size:16px;font-weight:600}
@media(min-width:600px){.stat-grid{grid-template-columns:repeat(4,1fr)}}
</style>
</head>
<body>
<div id="app"></div>
<div class="nf" id="nf"></div>
<script>
var MN=["Leden","√önor","B≈ôezen","Duben","Kvƒõten","ƒåerven","ƒåervenec","Srpen","Z√°≈ô√≠","≈ò√≠jen","Listopad","Prosinec"],
DN=["Po","√öt","St","ƒåt","P√°","So","Ne"],
HRS=["8:00","8:15","8:30","8:45", "9:00","9:15","9:30","9:45", "10:00","10:15","10:30","10:45", "11:00","11:15","11:30","11:45", "12:00","12:15","12:30","12:45", "13:00","13:15","13:30","13:45", "14:00","14:15","14:30","14:45", "15:00","15:15","15:30","15:45", "16:00","16:15","16:30","16:45", "17:00","17:15","17:30","17:45", "18:00"],
SK="md_nails_v7",
DSV=[{id:1,n:"Gel lak",d:60,c:"#E8A0BF",p:800},{id:2,n:"Akryl",d:90,c:"#C9A0DC",p:1200},{id:3,n:"Manik√∫ra",d:45,c:"#A0C4E8",p:500},{id:4,n:"Pedik√∫ra",d:60,c:"#A0E8C9",p:600},{id:5,n:"Zdoben√≠",d:30,c:"#E8D4A0",p:300},{id:6,n:"Doplnƒõn√≠",d:60,c:"#DCA0A0",p:700}];

var B={},SVC=JSON.parse(JSON.stringify(DSV)),NH=1,PIN="",ROLE="";
var tab="cal",selDay=null,selY=0,selM=0,sf=false,eid=null,selSvc=1,selTime="",ss=false,srch="",
resch=null,reschD="",reschT="",loginErr="",lastSync=0;
window._fn="";window._fp="";window._fnt="";

function dim(y,m){return new Date(y,m+1,0).getDate()}
function fd(y,m){var d=new Date(y,m,1).getDay();return d===0?6:d-1}
function dk(y,m,d){return y+"-"+String(m+1).padStart(2,"0")+"-"+String(d).padStart(2,"0")}
function fmt(k){var p=k.split("-");return+p[2]+"."+(+p[1])+"."+p[0]}
function isT(y,m,d){var t=new Date();return t.getFullYear()===y&&t.getMonth()===m&&t.getDate()===d}
function isTm(y,m,d){var t=new Date();t.setDate(t.getDate()+1);return t.getFullYear()===y&&t.getMonth()===m&&t.getDate()===d}
function isP(y,m,d){var t=new Date();t.setHours(0,0,0,0);return new Date(y,m,d)<t}
function isSu(y,m,d){return new Date(y,m,d).getDay()===0}
function dayN(y,m,d){return DN[(new Date(y,m,d).getDay()+6)%7]}
function E(s){return(s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}
function gb(k){return(B[k]||[]).slice().sort(function(a,b){return a.time<b.time?-1:1})}
function sv(id){return SVC.find(function(s){return s.id===id})||SVC[0]||DSV[0]}
function isAdmin(){return ROLE==="admin"}

function allNames(){var n={};Object.values(B).forEach(function(l){l.forEach(function(b){if(b.name)n[b.name]=b.phone||""})});return n}
function allPhones(){var p={};Object.values(B).forEach(function(l){l.forEach(function(b){if(b.phone)p[b.phone]=b.name||""})});return p}

function load(){try{var d=JSON.parse(localStorage.getItem(SK));if(d){B=d.bk||{};if(d.svc&&d.svc.length)SVC=d.svc;NH=d.nh!=null?d.nh:1;PIN=d.pin||"";lastSync=d.ts||0;ROLE=d.role||""}}catch(e){}}
function save(){try{lastSync=Date.now();localStorage.setItem(SK,JSON.stringify({bk:B,svc:SVC,nh:NH,pin:PIN,ts:lastSync,role:ROLE}))}catch(e){}}
function reloadData(){load();R()}

function expBak(){var d=JSON.stringify({bk:B,svc:SVC,nh:NH},null,2);var b=new Blob([d],{type:"application/json"});var u=URL.createObjectURL(b);var a=document.createElement("a");a.href=u;a.download="md_nails_"+new Date().toISOString().slice(0,10)+".json";a.click();nf("Z√°loha sta≈æena!")}
function impBak(f){var r=new FileReader();r.onload=function(e){try{var d=JSON.parse(e.target.result);B=d.bk||{};SVC=d.svc||JSON.parse(JSON.stringify(DSV));NH=d.nh||1;save();nf("Obnoveno!");R()}catch(x){nf("Chyba!","er")}};r.readAsText(f)}

var _nt;
function nf(t,c){clearTimeout(_nt);var e=document.getElementById("nf");e.textContent=t;e.className="nf "+(c||"ok");e.style.display="block";_nt=setTimeout(function(){e.style.display="none"},2600)}

function stats(){var t=0,d=0,c={},svcCnt={},rev=0;Object.values(B).forEach(function(l){l.forEach(function(b){t++;if(b.done){d++;rev+=sv(b.service).p}var nm=b.name.trim().toLowerCase();c[nm]=(c[nm]||0)+1;svcCnt[sv(b.service).n]=(svcCnt[sv(b.service).n]||0)+1})});var now=new Date(),mc=0;for(var i=1;i<=dim(now.getFullYear(),now.getMonth());i++)mc+=(B[dk(now.getFullYear(),now.getMonth(),i)]||[]).length;var topC=Object.entries(c).sort(function(a,b){return b[1]-a[1]}).slice(0,8);var topS=Object.entries(svcCnt).sort(function(a,b){return b[1]-a[1]});return{t:t,d:d,cl:Object.keys(c).length,mc:mc,topC:topC,topS:topS,rev:rev}}
function saveInputs(){var fn=document.getElementById("fn"),fp=document.getElementById("fp"),fnt=document.getElementById("fnt");if(fn)window._fn=fn.value;if(fp)window._fp=fp.value;if(fnt)window._fnt=fnt.value}
function fmtTime(){var d=new Date(lastSync);return d.toLocaleString("cs-CZ")}

// ===== RENDER =====
function R(){
if(!ROLE){renderLogin();return}
var adm=isAdmin(),a=document.getElementById("app"),h="";

h+='<div class="hdr'+(adm?"":" viewer")+'"><div class="hdr-r"><div><h1>‚úø MD Nails</h1><div class="sub">Nehtov√° designerka<span class="role-badge '+(adm?"role-admin":"role-view")+'">'+(adm?"üë©‚Äçüíº Admin":"üëÅ N√°hled")+"</span></div></div><div class=\"hdr-b\">";
if(adm)h+='<button class="hb" onclick="ss=!ss;srch=\'\';R()">üîç</button>';
h+='<button class="hb" onclick="ROLE=\'\';save();R()">üö™</button>';
h+="</div></div>";
if(ss)h+='<input class="si" type="text" placeholder="Hledat klienta..." value="'+E(srch)+'" oninput="srch=this.value;R()" id="sinp">';
h+="</div>";

// Sync bar for viewer
if(!adm){h+='<div class="sync-bar"><span class="sync-dot"></span>Posledn√≠ sync: '+fmtTime()+'<button onclick="reloadData();nf(\'Aktualizov√°no!\')">üîÑ Obnovit</button></div>'}

// Search
if(ss&&srch.trim()&&adm){
  var q=srch.toLowerCase(),res=[];
  Object.keys(B).forEach(function(k){(B[k]||[]).forEach(function(b){if(b.name.toLowerCase().indexOf(q)>=0||(b.phone||"").indexOf(q)>=0)res.push({b:b,k:k})})});
  h+='<div class="sec"><p style="font-size:13px;color:var(--t2);margin-bottom:8px;font-weight:700">Nalezeno: '+res.length+"</p>";
  res.forEach(function(r){var s=sv(r.b.service);h+='<div class="ri"><div><div style="font-weight:800;font-size:15px">'+E(r.b.name)+'</div><div style="font-size:12px;color:var(--t2);font-weight:600">'+fmt(r.k)+" ¬∑ "+r.b.time+" ¬∑ "+s.n+'</div></div><button style="background:#F0DCE8;border:none;border-radius:10px;padding:7px 16px;font-size:12px;font-weight:800;color:var(--g3);cursor:pointer" onclick="goEdit(\''+r.k+"',"+r.b.id+")\">\u270F\uFE0F</button></div>"});
  h+="</div>";
}

// ===== CAL TAB =====
if(tab==="cal"&&!(ss&&srch.trim())){
  var now=new Date(),tk=dk(now.getFullYear(),now.getMonth(),now.getDate());
  var t2=new Date();t2.setDate(t2.getDate()+1);var tmk=dk(t2.getFullYear(),t2.getMonth(),t2.getDate());
  var showKey=selDay||tk,showBks=gb(showKey);
  var sp=showKey.split("-").map(Number);
  var showLabel=(!selDay||showKey===tk)?"Dnes":(showKey===tmk?"Z√≠tra":sp[2]+". "+MN[sp[1]-1]);
  var isTmrw=showKey===tmk;

  if(showBks.length||selDay){
    h+='<div class="dcard'+(isTmrw?" tmrw":"")+'"><h4><span>'+(isTmrw?"\uD83D\uDD14":"\uD83D\uDCCB")+" "+showLabel+" ¬∑ "+showBks.length+" objedn√°vek</span>"+(adm?'<button class="edit-btn" onclick="openFormForDay(\''+showKey+"')\">+ P≈ôidat</button>":"")+"</h4>";
    if(showBks.length){showBks.forEach(function(b){
      var s=sv(b.service);
      h+='<div class="di"><span class="di-time">'+b.time+'</span><span class="di-name">'+E(b.name)+'</span><span class="di-svc" style="background:'+s.c+'">'+s.n+"</span>";
      if(b.done)h+='<span class="di-done">\u2705</span>';
      if(adm){h+='<span class="di-acts">';if(!b.done)h+='<button style="background:#E0F8EA;color:var(--ok)" onclick="mDone(\''+showKey+"',"+b.id+')">‚úì</button>';h+='<button style="background:#F0DCE8;color:var(--g3)" onclick="edBk(\''+showKey+"',"+b.id+')">\u270F\uFE0F</button><button style="background:#FDE8EC;color:var(--er)" onclick="dlBk(\''+showKey+"',"+b.id+')">\uD83D\uDDD1</button></span>'}
      h+="</div>";
    })}else{h+='<div style="text-align:center;padding:12px;color:var(--t3);font-weight:600">≈Ω√°dn√© objedn√°vky</div>'}
    h+="</div>";
  }

  // Tomorrow (if not selected day)
  if(!selDay&&gb(tmk).length){
    var tom=gb(tmk);
    h+='<div class="dcard tmrw"><h4><span class="tmrw-head">\uD83D\uDD14 Z√≠tra ¬∑ '+tom.length+" objedn√°vek</span></h4>";
    tom.forEach(function(b){var s=sv(b.service);h+='<div class="di"><span class="di-time">'+b.time+'</span><span class="di-name">'+E(b.name)+'</span><span class="di-svc" style="background:'+s.c+'">'+s.n+"</span></div>"});
    h+="</div>";
  }

  // Form (admin only)
  if(sf&&adm){
    var fk=selDay||tk;
    var booked=(B[fk]||[]).filter(function(b){return eid?b.id!==eid:true}).map(function(b){return b.time});
    h+='<div class="sec"><div class="fc"><h3>'+(eid?"\u270F\uFE0F Upravit":"\u2740 Nov√° objedn√°vka")+"</h3>";
    h+='<div class="fl"><label>Jm√©no</label><input type="text" id="fn" placeholder="Jana Nov√°kov√°" oninput="showAC(\'fn\',\'name\')"><div class="acomp" id="ac_fn"></div></div>';
   
    h+='<div class="fl"><label>Slu≈æba</label><div class="sg">';
    SVC.forEach(function(s){h+='<button class="sb'+(selSvc===s.id?" a":"")+'" style="'+(selSvc===s.id?"background:"+s.c+";border-color:"+s.c:"")+'" onclick="pSvc('+s.id+')">'+E(s.n)+"<small>"+s.d+" min ¬∑ "+s.p+" Kƒç</small></button>"});
    h+='</div></div><div class="fl"><label>ƒåas</label><div class="tg">';
    HRS.forEach(function(t){var bkd=booked.indexOf(t)>=0;h+='<button class="tm2'+(selTime===t?" a":"")+(bkd?" bk2":"")+'" '+(bkd?"disabled ":"")+"onclick=\"pTime('"+t+"')\">"+t+"</button>"});
    h+='</div></div><div class="fl"><label>Pozn√°mka</label><textarea rows="2" id="fnt" placeholder="Speci√°ln√≠ po≈æadavky..."></textarea></div>';
    h+='<div class="fb"><button class="bp" onclick="subForm()">'+(eid?"Ulo≈æit":"Potvrdit")+'</button><button class="bs2" onclick="sf=false;eid=null;R()">Zru≈°it</button></div></div></div>';
  }

  // Calendar
  h+='<div class="sec">';
  var cY=now.getFullYear(),cM=now.getMonth(),dLeft=dim(cY,cM)-now.getDate();
  var mos=[{y:cY,m:cM}];
  if(dLeft<=14){var nm=cM+1,ny=cY;if(nm>11){nm=0;ny++}mos.push({y:ny,m:nm})}
  mos.forEach(function(mo2){
    var mY=mo2.y,mM=mo2.m;
    h+='<div class="cc"><h2>'+MN[mM]+" "+mY+'</h2><div class="wr">'+DN.map(function(d){return'<div class="wd">'+d+"</div>"}).join("")+'</div><div class="dg">';
    for(var e=0;e<fd(mY,mM);e++)h+="<div></div>";
    for(var d=1;d<=dim(mY,mM);d++){
      var k=dk(mY,mM,d),bks=B[k]||[],t=isT(mY,mM,d),tm=isTm(mY,mM,d),p=isP(mY,mM,d),su=isSu(mY,mM,d);
      var cls="dc";if(t)cls+=" to";else if(tm)cls+=" tw";else if(su)cls+=" su";else if(p)cls+=" pa";
      if(bks.length&&!t)cls+=" hb2";
      if(selDay===k&&!t)cls+=" sel";
      var badge=bks.length?'<span class="badge">'+bks.length+"</span>":"";
      h+='<button class="'+cls+'" '+(su?"":"onclick=\"pickDay('"+k+"')\"")+" >"+d+badge+"</button>";
    }
    h+="</div></div>";
  });
  h+="</div>";
}

// Price
if(tab==="price"){
  h+='<div class="sec"><div class="sc2"><h3>\uD83D\uDCB0 Cen√≠k slu≈æeb</h3>';
  SVC.forEach(function(s){h+='<div class="pr"><span class="pdt" style="background:'+s.c+'"></span><span class="pn">'+E(s.n)+'</span><span class="pdur">'+s.d+' min</span><span class="pv">'+s.p+" Kƒç</span></div>"});
  h+="</div></div>";
}

// Stats
if(tab==="stats"){
  var st=stats();
  h+='<div class="sec"><div class="stat-grid">';
  h+='<div class="stat-box"><div class="sv" style="color:var(--g1)">'+st.t+'</div><div class="sl">Celkem</div></div>';
  h+='<div class="stat-box"><div class="sv" style="color:var(--ok)">'+st.d+'</div><div class="sl">Hotovo</div></div>';
  h+='<div class="stat-box"><div class="sv" style="color:var(--g2)">'+st.cl+'</div><div class="sl">Klient≈Ø</div></div>';
  h+='<div class="stat-box"><div class="sv" style="color:var(--g3)">'+st.mc+'</div><div class="sl">'+MN[new Date().getMonth()]+"</div></div>";
  h+="</div>";
  if(st.rev){h+='<div class="sc2" style="text-align:center"><div style="font-size:13px;font-weight:700;color:var(--t2)">Celkov√Ω obrat (dokonƒçeno)</div><div style="font-size:36px;font-weight:800;color:var(--ok);margin-top:4px">'+st.rev.toLocaleString("cs")+" Kƒç</div></div>"}
  if(st.topC.length){
    h+='<div class="top-card"><h3>\uD83D\uDC51 Nejƒçastƒõj≈°√≠ klienti</h3>';
    var colors=["var(--g1)","var(--g2)","var(--g3)","#C08040","#6090C0","#60A080","#A08060","#8080B0"];
    st.topC.forEach(function(c,i){
      var origName=c[0];
      Object.values(B).forEach(function(l){l.forEach(function(b){if(b.name.trim().toLowerCase()===origName)origName=b.name.trim()})});
      h+='<div class="top-row"><span class="top-rank" style="background:'+(colors[i]||"var(--t3)")+'">'+((i+1))+'</span><span class="top-name">'+E(origName)+'</span><span class="top-cnt">'+c[1]+"\u00D7</span></div>"});
    h+="</div>";
  }
  if(st.topS.length){
    h+='<div class="top-card"><h3>\uD83D\uDC85 Slu≈æby</h3>';
    st.topS.forEach(function(s){var sObj=SVC.find(function(x){return x.n===s[0]});h+='<div class="top-row"><span class="top-rank" style="background:'+(sObj?sObj.c:"var(--g1)")+'">'+s[1]+'</span><span class="top-name">'+E(s[0])+"</span></div>"});
    h+="</div>";
  }
  h+="</div>";
}

// Settings (admin only)
if(tab==="set"&&adm){
  h+='<div class="sec">';
  h+='<div class="sc2"><h3>\uD83D\uDD14 Upozornƒõn√≠</h3><div class="sr"><label>Hodiny p≈ôedem</label><input type="number" value="'+NH+'" min="0" max="24" onchange="NH=+this.value;save()"></div></div>';
  h+='<div class="sc2"><h3>\uD83D\uDD12 Admin PIN</h3><div class="sr"><label>Aktu√°ln√≠</label><span style="font-weight:800;font-size:16px;letter-spacing:3px">'+(PIN?PIN.replace(/./g,"\u2022"):"Nen√≠")+'</span></div><div class="sr"><label>Nov√Ω PIN</label><input type="number" id="newpin" placeholder="1234" style="width:80px;letter-spacing:4px;font-weight:800"></div><div class="sr"><label></label><button class="sb3" onclick="setPin()">Ulo≈æit</button><button style="background:#FDE8EC;color:var(--er);border:none;border-radius:10px;padding:8px 14px;font-weight:800;font-size:13px;cursor:pointer;margin-left:6px" onclick="PIN=\'\';save();nf(\'PIN smaz√°n\');R()">Smazat</button></div></div>';
  h+='<div class="sc2"><h3>\uD83D\uDC85 Slu≈æby</h3>';
  SVC.forEach(function(s){h+='<div class="se"><input type="color" value="'+s.c+'" onchange="uS('+s.id+',&quot;c&quot;,this.value)"><input type="text" value="'+E(s.n)+'" oninput="uSL('+s.id+',&quot;n&quot;,this.value)" onblur="save()"><input type="number" value="'+s.d+'" onchange="uS('+s.id+',&quot;d&quot;,+this.value)"><input type="number" value="'+s.p+'" onchange="uS('+s.id+',&quot;p&quot;,+this.value)">'+(SVC.length>1?'<button class="sd" onclick="dS('+s.id+')">‚úï</button>':"")+"</div>"});
  h+='<button class="sa" onclick="aS()">+ P≈ôidat slu≈æbu</button></div>';
  h+='<div class="sc2"><h3>\uD83D\uDCBE Z√°loha</h3><div class="sr"><label>Export</label><button class="sb3" onclick="expBak()">\uD83D\uDCE5 St√°hnout</button></div><div class="sr"><label>Import</label><input type="file" accept=".json" onchange="impBak(this.files[0])" style="font-size:13px;max-width:160px;font-weight:600"></div></div>';
  h+='<div class="sc2"><h3>\u2139\uFE0F Sd√≠len√≠</h3><p style="font-size:13px;color:var(--t2);font-weight:600;line-height:1.6">Ulo≈æte tento soubor na <strong>iCloud Drive</strong> nebo <strong>Google Drive</strong>. Man≈æel otev≈ôe stejn√Ω soubor a zvol√≠ <strong>\"N√°hled\"</strong> ‚Äî uvid√≠ kalend√°≈ô, jm√©na i statistiky (bez mo≈ænosti editace). Pro aktualizaci staƒç√≠ kliknout <strong>\"Obnovit\"</strong>.</p></div>';
  h+="</div>";
}

// Reschedule modal
if(resch&&adm){
  var rb=resch.bk;
  h+='<div class="mbg" onclick="if(event.target===this){resch=null;R()}"><div class="mbox"><h3>\uD83D\uDCC5 Dal≈°√≠ term√≠n</h3><p style="font-size:15px;color:var(--t2);margin-bottom:16px;font-weight:600"><strong>'+E(rb.name)+"</strong> ‚Äî "+sv(rb.service).n+"</p>";
  h+='<div class="fl"><label>Datum</label><input type="date" value="'+reschD+'" onchange="reschD=this.value"></div>';
  h+='<div class="fl"><label>ƒåas</label><div class="tg">';
  HRS.forEach(function(t){h+='<button class="tm2'+(reschT===t?" a":"")+'" onclick="reschT=\''+t+"';R()\">"+t+"</button>"});
  h+='</div></div><div class="fb"><button class="bp" onclick="cResch()">Potvrdit</button><button class="bs2" onclick="resch=null;R()">P≈ôeskoƒçit</button></div></div></div>';
}

// Bottom nav
h+='<div class="bnav">';
h+='<button class="'+(tab==="cal"?"a":"")+'" onclick="setT(\'cal\')"><span class="ic">\uD83D\uDCC5</span>Kalend√°≈ô</button>';
h+='<button class="'+(tab==="price"?"a":"")+'" onclick="setT(\'price\')"><span class="ic">\uD83D\uDCB0</span>Cen√≠k</button>';
h+='<button class="'+(tab==="stats"?"a":"")+'" onclick="setT(\'stats\')"><span class="ic">\uD83D\uDCCA</span>Statistiky</button>';
if(adm)h+='<button class="'+(tab==="set"?"a":"")+'" onclick="setT(\'set\')"><span class="ic">\u2699\uFE0F</span>Nastaven√≠</button>';
h+="</div>";

a.innerHTML=h;
if(sf){var fn=document.getElementById("fn"),fp=document.getElementById("fp"),fnt=document.getElementById("fnt");if(fn)fn.value=window._fn||"";if(fp)fp.value=window._fp||"";if(fnt)fnt.value=window._fnt||""}
if(ss){var si=document.getElementById("sinp");if(si)setTimeout(function(){si.focus()},10)}
}

function renderLogin(){
  document.getElementById("app").innerHTML='<div class="login-bg"><div class="login-box"><h2>\u2740 MD Nails</h2><p>Zvolte p≈ô√≠stup</p>'+(PIN?'<input type="password" id="pinInput" maxlength="8" placeholder="\u00B7\u00B7\u00B7\u00B7" inputmode="numeric" onkeydown="if(event.key===\'Enter\')doLogin(\'admin\')"><button class="btn-admin" onclick="doLogin(\'admin\')">\uD83D\uDD13 Admin (PIN)</button>':'<button class="btn-admin" onclick="doLogin(\'admin\')">\uD83D\uDC69\u200D\uD83D\uDCBC Admin</button>')+'<div class="divider">nebo</div><button class="btn-viewer" onclick="doLogin(\'viewer\')">\uD83D\uDC41 N√°hled (jen ƒçten√≠)</button>'+(loginErr?'<div class="err2">'+loginErr+"</div>":"")+"</div></div>";
  if(PIN)setTimeout(function(){var i=document.getElementById("pinInput");if(i)i.focus()},100);
}

function doLogin(role){
  if(role==="admin"&&PIN){var i=document.getElementById("pinInput");if(!i||i.value!==PIN){loginErr="≈†patn√Ω PIN!";renderLogin();return}}
  ROLE=role;loginErr="";save();R();
}
function setPin(){var i=document.getElementById("newpin");if(i&&i.value.trim()){PIN=i.value.trim();save();nf("PIN ulo≈æen!");R()}else{nf("Zadejte PIN!","er")}}
function setT(t){tab=t;sf=false;eid=null;ss=false;srch="";selDay=null;R()}
function pickDay(k){selDay=(selDay===k)?null:k;sf=false;eid=null;var p=k.split("-").map(Number);selY=p[0];selM=p[1]-1;R()}
function openFormForDay(k){var p=k.split("-").map(Number);selY=p[0];selM=p[1]-1;selDay=k;sf=true;eid=null;selSvc=SVC[0]?SVC[0].id:1;selTime="";window._fn="";window._fp="";window._fnt="";R();setTimeout(function(){var f=document.querySelector(".fc");if(f)f.scrollIntoView({behavior:"smooth"});var i=document.getElementById("fn");if(i)i.focus()},120)}
function pSvc(id){saveInputs();selSvc=id;R()}
function pTime(t){saveInputs();selTime=t;R()}

function showAC(iid,type){
  var inp=document.getElementById(iid);if(!inp)return;
  var val=inp.value.trim().toLowerCase(),div=document.getElementById("ac_"+iid);if(!div)return;
  if(val.length<1){div.className="acomp";return}
  var items=[];
  if(type==="name"){var names=allNames();Object.keys(names).forEach(function(n){if(n.toLowerCase().indexOf(val)>=0)items.push({v:n,sub:names[n]})})}
  else{var phones=allPhones();Object.keys(phones).forEach(function(p){if(p.indexOf(val)>=0)items.push({v:p,sub:phones[p]})})}
  if(!items.length){div.className="acomp";return}
  div.className="acomp show";
  div.innerHTML=items.slice(0,5).map(function(it){return'<div class="aci" onmousedown="pickAC(\''+iid+"','"+E(it.v).replace(/'/g,"&#39;")+"','"+E(it.sub).replace(/'/g,"&#39;")+"','"+type+"')\">"+E(it.v)+(it.sub?' <span style="color:var(--t3);font-size:12px">\u00B7 '+E(it.sub)+"</span>":"")+"</div>"}).join("")}
function pickAC(iid,val,sub,type){var inp=document.getElementById(iid);if(inp)inp.value=val;var div=document.getElementById("ac_"+iid);if(div)div.className="acomp";if(type==="name"&&sub){var fp=document.getElementById("fp");if(fp&&!fp.value)fp.value=sub}if(type==="phone"&&sub){var fn=document.getElementById("fn");if(fn&&!fn.value)fn.value=sub}}

function subForm(){
  var fn=document.getElementById("fn"),fp=document.getElementById("fp"),fnt=document.getElementById("fnt");
  var name=fn?fn.value.trim():"",phone=fp?fp.value.trim():"",note=fnt?fnt.value.trim():"";
  if(!name||!selTime){nf("Vypl≈àte jm√©no a ƒças!","er");return}
  var k=selDay||dk(new Date().getFullYear(),new Date().getMonth(),new Date().getDate());
  if(!B[k])B[k]=[];
  if(eid){var i=B[k].findIndex(function(b){return b.id===eid});if(i>=0)B[k][i]={name:name,phone:phone,service:selSvc,time:selTime,note:note,id:eid,done:B[k][i].done};nf("Upraveno!")}
  else{B[k].push({name:name,phone:phone,service:selSvc,time:selTime,note:note,id:Date.now(),done:false});nf("P≈ôid√°no! \u2740")}
  save();sf=false;eid=null;R()}

function dlBk(k,id){if(!confirm("Smazat?"))return;B[k]=(B[k]||[]).filter(function(b){return b.id!==id});if(!B[k].length)delete B[k];save();nf("Smaz√°no");R()}
function edBk(k,id){var b=(B[k]||[]).find(function(x){return x.id===id});if(!b)return;var p=k.split("-").map(Number);selY=p[0];selM=p[1]-1;selDay=k;eid=id;sf=true;selSvc=b.service;selTime=b.time;window._fn=b.name;window._fp=b.phone||"";window._fnt=b.note||"";R();setTimeout(function(){var f=document.querySelector(".fc");if(f)f.scrollIntoView({behavior:"smooth"})},120)}
function goEdit(k,id){tab="cal";ss=false;srch="";edBk(k,id)}

function mDone(k,id){var b=(B[k]||[]).find(function(x){return x.id===id});if(!b)return;b.done=true;save();nf("Hotovo! \u2705");var p=k.split("-").map(Number),nd=new Date(p[0],p[1]-1,p[2]);nd.setDate(nd.getDate()+14);resch={dk:k,bk:b};reschD=dk(nd.getFullYear(),nd.getMonth(),nd.getDate());reschT=b.time;R()}
function cResch(){if(!resch||!reschD||!reschT){nf("Vypl≈àte!","er");return}var b=resch.bk;if(!B[reschD])B[reschD]=[];B[reschD].push({name:b.name,phone:b.phone||"",service:b.service,time:reschT,note:b.note||"",id:Date.now(),done:false});save();resch=null;nf("Nov√Ω term√≠n!");R()}
function uS(id,f,v){var s=SVC.find(function(x){return x.id===id});if(s){s[f]=v;save();R()}}
function uSL(id,f,v){var s=SVC.find(function(x){return x.id===id});if(s)s[f]=v}
function aS(){SVC.push({id:Math.max.apply(null,SVC.map(function(s){return s.id}).concat([0]))+1,n:"Nov√° slu≈æba",d:60,c:"#FFB6C1",p:500});save();R()}
function dS(id){if(!confirm("Smazat?")){return}SVC=SVC.filter(function(s){return s.id!==id});save();R()}

load();R();
if("Notification" in window&&Notification.permission==="default")Notification.requestPermission();
setInterval(save,30000);
if("serviceWorker" in navigator){try{navigator.serviceWorker.register(URL.createObjectURL(new Blob(["self.addEventListener('install',function(e){self.skipWaiting()});self.addEventListener('activate',function(e){e.waitUntil(clients.claim())});self.addEventListener('fetch',function(e){e.respondWith(fetch(e.request).catch(function(){return caches.match(e.request)}))})"],{type:"application/javascript"}))).catch(function(){})}catch(e){}}
</script>
</body>
</html>
